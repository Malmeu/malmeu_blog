---
// Cette page est prot√©g√©e c√¥t√© client
---

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestion des Articles - Admin</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --color-bg: #0a0a0f;
      --color-bg-secondary: #1a1a2e;
      --color-text: #ffffff;
      --color-text-muted: #a0a0a0;
      --color-accent: #06b6d4;
      --color-accent-orange: #f97316;
    }
    body {
      background-color: var(--color-bg);
      color: var(--color-text);
    }
  </style>
</head>
<body class="min-h-screen">
  <!-- Header -->
  <header class="bg-[#1a1a2e] border-b border-[#2a2a3e] px-6 py-4">
    <div class="max-w-7xl mx-auto flex items-center justify-between">
      <div class="flex items-center gap-4">
        <a href="/admin/comments" class="text-[#a0a0a0] hover:text-white transition-colors">
          ‚Üê Retour aux commentaires
        </a>
        <h1 class="text-xl font-bold text-white">üìù Gestion des Articles</h1>
      </div>
      <div class="flex items-center gap-4">
        <a 
          href="/admin/articles/new"
          class="px-4 py-2 bg-gradient-to-r from-[#06b6d4] to-[#f97316] text-white rounded-lg font-medium hover:opacity-90 transition-opacity"
        >
          + Nouvel Article
        </a>
        <button 
          id="logout-btn"
          class="px-4 py-2 bg-red-500/20 text-red-400 rounded-lg hover:bg-red-500/30 transition-colors"
        >
          D√©connexion
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-6 py-8">
    <!-- Stats -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
      <div class="bg-[#1a1a2e] rounded-xl p-4">
        <p class="text-[#a0a0a0] text-sm">Total Articles</p>
        <p id="stat-total" class="text-2xl font-bold text-white">-</p>
      </div>
      <div class="bg-[#1a1a2e] rounded-xl p-4">
        <p class="text-[#a0a0a0] text-sm">Publi√©s</p>
        <p id="stat-published" class="text-2xl font-bold text-green-400">-</p>
      </div>
      <div class="bg-[#1a1a2e] rounded-xl p-4">
        <p class="text-[#a0a0a0] text-sm">Brouillons</p>
        <p id="stat-drafts" class="text-2xl font-bold text-yellow-400">-</p>
      </div>
      <div class="bg-[#1a1a2e] rounded-xl p-4">
        <p class="text-[#a0a0a0] text-sm">Sponsoris√©s</p>
        <p id="stat-sponsored" class="text-2xl font-bold text-amber-400">-</p>
      </div>
    </div>

    <!-- Articles List -->
    <div class="bg-[#1a1a2e] rounded-xl overflow-hidden">
      <div class="px-6 py-4 border-b border-[#2a2a3e]">
        <h2 class="text-lg font-semibold text-white">Articles</h2>
      </div>
      
      <div id="articles-list" class="divide-y divide-[#2a2a3e]">
        <div class="px-6 py-8 text-center text-[#a0a0a0]">
          Chargement des articles...
        </div>
      </div>
    </div>
  </main>

  <script>
    // Auth check
    const isAuthenticated = localStorage.getItem('admin_authenticated') === 'true';
    if (!isAuthenticated) {
      window.location.href = '/admin/login';
    }

    // Logout
    document.getElementById('logout-btn')?.addEventListener('click', () => {
      localStorage.removeItem('admin_authenticated');
      window.location.href = '/admin/login';
    });

    // Load articles
    async function loadArticles() {
      try {
        const response = await fetch('/api/articles');
        const articles = await response.json();
        
        // Update stats
        document.getElementById('stat-total')!.textContent = articles.length.toString();
        document.getElementById('stat-published')!.textContent = articles.filter((a: any) => !a.draft).length.toString();
        document.getElementById('stat-drafts')!.textContent = articles.filter((a: any) => a.draft).length.toString();
        document.getElementById('stat-sponsored')!.textContent = articles.filter((a: any) => a.sponsored).length.toString();
        
        // Render articles
        const listEl = document.getElementById('articles-list')!;
        
        if (articles.length === 0) {
          listEl.innerHTML = `
            <div class="px-6 py-12 text-center">
              <p class="text-[#a0a0a0] mb-4">Aucun article pour le moment</p>
              <a href="/admin/articles/new" class="text-[#06b6d4] hover:underline">
                Cr√©er votre premier article ‚Üí
              </a>
            </div>
          `;
          return;
        }
        
        listEl.innerHTML = articles.map((article: any) => `
          <div class="px-6 py-4 flex items-center justify-between hover:bg-[#2a2a3e]/50 transition-colors">
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2 mb-1">
                ${article.draft ? '<span class="px-2 py-0.5 bg-yellow-500/20 text-yellow-400 text-xs rounded-full">Brouillon</span>' : '<span class="px-2 py-0.5 bg-green-500/20 text-green-400 text-xs rounded-full">Publi√©</span>'}
                ${article.featured ? '<span class="px-2 py-0.5 bg-purple-500/20 text-purple-400 text-xs rounded-full">‚≠ê Vedette</span>' : ''}
                ${article.sponsored ? '<span class="px-2 py-0.5 bg-amber-500/20 text-amber-400 text-xs rounded-full">üí∞ Sponsoris√©</span>' : ''}
                <span class="px-2 py-0.5 bg-[#06b6d4]/20 text-[#06b6d4] text-xs rounded-full">${article.category || 'Sans cat√©gorie'}</span>
              </div>
              <h3 class="text-white font-medium truncate">${article.title || 'Sans titre'}</h3>
              <p class="text-[#a0a0a0] text-sm truncate">${article.description || 'Pas de description'}</p>
              <p class="text-[#a0a0a0] text-xs mt-1">
                ${article.publishDate ? new Date(article.publishDate).toLocaleDateString('fr-FR') : 'Date non d√©finie'}
                ¬∑ ${article.slug}.md
              </p>
            </div>
            <div class="flex items-center gap-2 ml-4">
              <a 
                href="/blog/${article.slug}" 
                target="_blank"
                class="p-2 text-[#a0a0a0] hover:text-white hover:bg-[#2a2a3e] rounded-lg transition-colors"
                title="Voir l'article"
              >
                üëÅÔ∏è
              </a>
              <a 
                href="/admin/articles/${article.slug}"
                class="p-2 text-[#a0a0a0] hover:text-[#06b6d4] hover:bg-[#06b6d4]/10 rounded-lg transition-colors"
                title="Modifier"
              >
                ‚úèÔ∏è
              </a>
              <button 
                onclick="deleteArticle('${article.slug}')"
                class="p-2 text-[#a0a0a0] hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-colors"
                title="Supprimer"
              >
                üóëÔ∏è
              </button>
            </div>
          </div>
        `).join('');
        
      } catch (error) {
        console.error('Failed to load articles:', error);
        document.getElementById('articles-list')!.innerHTML = `
          <div class="px-6 py-8 text-center text-red-400">
            Erreur lors du chargement des articles
          </div>
        `;
      }
    }

    // Delete article
    async function deleteArticle(slug: string) {
      if (!confirm(`√ätes-vous s√ªr de vouloir supprimer l'article "${slug}" ?`)) {
        return;
      }
      
      try {
        const response = await fetch('/api/articles', {
          method: 'DELETE',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ slug }),
        });
        
        if (response.ok) {
          loadArticles();
        } else {
          alert('Erreur lors de la suppression');
        }
      } catch (error) {
        alert('Erreur lors de la suppression');
      }
    }

    // Make deleteArticle available globally
    (window as any).deleteArticle = deleteArticle;

    // Initial load
    loadArticles();
  </script>
</body>
</html>
